unit View_UFrmPadraoCadastro;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ComCtrls, Data.DB, Vcl.StdCtrls,
  Vcl.Grids, Vcl.DBGrids, Vcl.ToolWin, Vcl.Menus, System.ImageList, Vcl.ImgList,
  Vcl.ExtCtrls;

type
  TView_FrmPadraoCadastro = class(TForm)
    BarraStatusPadraoCadastro: TStatusBar;
    ListaDeImagens: TImageList;
    PMenuGridCadastro: TPopupMenu;
    xxxxxxxxxxx1: TMenuItem;
    BarraBotoes: TToolBar;
    BtnNovo: TToolButton;
    BtnGravar: TToolButton;
    BtnEditar: TToolButton;
    BtnCancelar: TToolButton;
    BtnExcluir: TToolButton;
    PGControle: TPageControl;
    Aba01: TTabSheet;
    GBAba01: TGroupBox;
    EdtCodigo: TEdit;
    AbaPesquisar: TTabSheet;
    GbPesquisar: TGroupBox;
    CbPesquisar: TComboBox;
    EdtPesquisar: TEdit;
    BtnPesquisar: TButton;
    GbResultadoPesquisa: TGroupBox;
    DBPesquisa: TDBGrid;
    Label2: TLabel;
    Label3: TLabel;
    Separador: TToolButton;
    BtnSair: TToolButton;
    Aba02: TTabSheet;
    Aba03: TTabSheet;
    Aba04: TTabSheet;
    GBAba02: TGroupBox;
    GBAba03: TGroupBox;
    GBAba04: TGroupBox;
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure FormKeyPress(Sender: TObject; var Key: Char);
    procedure FormKeyDown(Sender: TObject; var Key: Word; Shift: TShiftState);
    procedure Botoes(botaoNum:Integer);
    procedure BtnPesquisarClick(Sender: TObject);
    procedure BtnNovoClick(Sender: TObject);
    procedure BtnGravarClick(Sender: TObject);
    procedure BtnEditarClick(Sender: TObject);
    procedure BtnCancelarClick(Sender: TObject);
    procedure BtnExcluirClick(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure DBPesquisaDblClick(Sender: TObject);
    procedure BtnSairClick(Sender: TObject);
  private
    { Private declarations }
    var opcao:string;

  public
    { Public declarations }
  end;

var
  View_FrmPadraoCadastro: TView_FrmPadraoCadastro;

implementation

{$R *.dfm}

procedure TView_FrmPadraoCadastro.Botoes(botaoNum:Integer);
begin

  //Controle dos botões
  case botaoNum of
    0:begin //Novo Registro
       BtnNovo.Enabled    :=False;
       BtnGravar.Enabled  :=true;
       BtnEditar.Enabled  :=False;
       BtnCancelar.Enabled:=true;
       BtnExcluir.Enabled :=False;
       EdtCodigo.Clear;
      end;
    1:begin //Botão Gravar
       BtnNovo.Enabled    :=true;
       BtnGravar.Enabled  :=false;
       BtnEditar.Enabled  :=true;
       BtnCancelar.Enabled:=false;
       BtnExcluir.Enabled :=true;
      end;
    2:begin //Botão Editar
       BtnNovo.Enabled    :=false;
       BtnGravar.Enabled  :=true;
       BtnEditar.Enabled  :=false;
       BtnCancelar.Enabled:=true;
       BtnExcluir.Enabled :=false;
      end;
    3:begin //Botão Limpar/Cancelar
       BtnNovo.Enabled    :=true;
       BtnGravar.Enabled  :=false;
       BtnEditar.Enabled  :=false;
       BtnCancelar.Enabled:=false;
       BtnExcluir.Enabled :=false;
       EdtCodigo.Clear;
      end;
    4:begin //Botão Excluir
       BtnNovo.Enabled    :=true;
       BtnGravar.Enabled  :=false;
       BtnEditar.Enabled  :=false;
       BtnCancelar.Enabled:=true;
       BtnExcluir.Enabled :=false;
       EdtCodigo.Clear;
      end;
    5:begin //carregando formulário
       BtnNovo.Enabled    :=true;
       BtnGravar.Enabled  :=False;
       BtnEditar.Enabled  :=False;
       BtnCancelar.Enabled:=False;
       BtnExcluir.Enabled :=False;
      end;
    6:begin //carregando aba01 do Grid com duploclick.
       BtnNovo.Enabled    :=false;
       BtnGravar.Enabled  :=true;
       BtnEditar.Enabled  :=false;
       BtnCancelar.Enabled:=true;
       BtnExcluir.Enabled :=false;
       Aba01.Show;
      end;

  end;
end;

procedure TView_FrmPadraoCadastro.BtnEditarClick(Sender: TObject);
begin
  Botoes(2);
end;

procedure TView_FrmPadraoCadastro.BtnExcluirClick(Sender: TObject);
begin
  opcao:='N';
if (messagebox(HANDLE,'DESEJA EXCLUIR O REGISTRO?','AVISO - SISTEMA',MB_IconQuestion+MB_YesNo+MB_defbutton1) = IdYes) then
      Begin
        opcao:='S';//(Sim para Excluir)
        Botoes(4);
      End;
end;

procedure TView_FrmPadraoCadastro.BtnGravarClick(Sender: TObject);
begin
  Botoes(1);
end;

procedure TView_FrmPadraoCadastro.BtnCancelarClick(Sender: TObject);
begin
  opcao:='N';
  if (messagebox(HANDLE,'DESEJA CANCELAR?','AVISO - SISTEMA',MB_IconQuestion+MB_YesNo+MB_defbutton1) = IdYes) then
      begin
        opcao:='S';//Sim para Cancelar Edição.
        Botoes(3);
      end;
end;

procedure TView_FrmPadraoCadastro.BtnNovoClick(Sender: TObject);
begin
  Botoes(0);
end;

procedure TView_FrmPadraoCadastro.BtnPesquisarClick(Sender: TObject);
begin
   if (CbPesquisar.Text = '') then
      begin
        ShowMessage('Obrigatório Informar o Tipo de Pesquisar que Desejas Fazer!.');
        CbPesquisar.SetFocus;
        Abort;
      end;


   if ((CbPesquisar.Text <> '')  and (EdtPesquisar.Text = '')) then
      begin
        ShowMessage('Obrigatório Informar ('+CbPesquisar.Text+') Para Localizar!.');
        EdtPesquisar.SetFocus;
        Abort;
      end;
end;

procedure TView_FrmPadraoCadastro.BtnSairClick(Sender: TObject);
begin
  Close;
end;

procedure TView_FrmPadraoCadastro.DBPesquisaDblClick(Sender: TObject);
begin
  //Detalhes
  Botoes(6);
end;

procedure TView_FrmPadraoCadastro.FormClose(Sender: TObject;
  var Action: TCloseAction);
begin
  {Verifico se o botão gravar está ativo e digo que só pode
   sair se gravar ou cancelar.}
   if (BtnGravar.Enabled = true) then
      begin
       ShowMessage('ATENÇÃO!! - SALVE O REGISTRO OU CANCELE OPERAÇÃO PARA CONTINUAR!.');
       Abort;
      end
   else
     begin
      Action:=Cafree;
      View_FrmPadraoCadastro:=nil;
     end;
end;

procedure TView_FrmPadraoCadastro.FormKeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
begin
  //Teclas
  case key of
    vk_f2:BtnNovoClick(Sender);
    vk_f3:BtnGravarClick(Sender);
    vk_f4:BtnEditarClick(Sender);
    vk_f5:BtnCancelarClick(Sender);
    vk_f6:BtnExcluirClick(Sender);
    vk_f7:BtnSairClick(Sender);
    VK_RETURN:Perform(Wm_NextDlgCtl,0,0);
  end;
end;

procedure TView_FrmPadraoCadastro.FormKeyPress(Sender: TObject; var Key: Char);
begin
  //Fechar a tela usando ESC.
  If (Key = #27) Then
      Close;
end;

procedure TView_FrmPadraoCadastro.FormShow(Sender: TObject);
begin
  Botoes(5);
end;

end.
